function init(){$("#section").on("submit",'form[name="section"]',function(event){var form=$(this);var url=form.attr("action");var valid=isFormValid(form);var btn=form.find(".btn-primary");if(valid){btn.button("loading");$.ajax({type:"POST",url:url,data:form.serialize()}).always(function(){btn.button("reset");$("body,html").animate({scrollTop:0},"fast");resetAlert($("#section"))}).done(function(data){showSuccess(form,data.status_msg)}).fail(function(jqXHR){var status_msg=getStatusMsg(jqXHR);showPermanentError(form,status_msg)})}return false});$("#section").on("section.loaded",function(event){$(":input:not(:disabled):not([readonly]):visible:enabled:first[name]").focus();$(".compound-input-btn-group .btn-group input").each(function(i,input){var value=$(input).attr("value");var a=$(input).siblings('a[value="'+value+'"]');a.attr("default-value","yes")});$("#tabView").find('[data-toggle="tab"]').first().tab("show")});$("#section").on("reset",function(event){$('.compound-input-btn-group .btn-group a[default-value="yes"]').click();return true});$("#section").on("show",'[href="#newTabView"]',function(e){var btn=$(e.target);var name=btn.attr("href");var target=$(name);var url=btn.attr("data-href");target.load(url,function(){target.find(".switch").bootstrapSwitch()});return true});var href=$(".sidenav-category a").first().attr("href");if(href){href=href.replace(/^.*#/,"/")}else{href="/configuration"}$(window).hashchange(pfOnHashChange(updateSection,href));$(window).hashchange();activateNavLink()}$(function(){$("#section").on("click",'.sources [href*="/delete"]',function(event){if($(this).hasClass("disabled"))return false;var url=$(this).attr("href");var row=$(this).closest("tr");var name=row.find('[href*="/read"]').first().text();var modal=$("#deleteSource");var confirm_link=modal.find("a.btn-primary").first();modal.find("h3 span").html(name);modal.modal({show:true});confirm_link.off("click");confirm_link.click(function(){$.ajax(url).always(function(){modal.modal("hide")}).done(function(data){$(window).hashchange()}).fail(function(jqXHR){$("body,html").animate({scrollTop:0},"fast");var status_msg=getStatusMsg(jqXHR);showError($("#section h2"),status_msg)});return false});return false});$("#section").on("click","#testSource",function(e){e.preventDefault();var btn=$(this);var form=btn.closest("form");var valid=isFormValid(form);resetAlert($("#section"));if(valid){$.ajax({type:"POST",url:btn.attr("href"),data:form.serialize()}).done(function(data){showSuccess(form,data.status_msg)}).fail(function(jqXHR){var status_msg=getStatusMsg(jqXHR);showPermanentError(form,status_msg)})}});$("#section").on("submit",'form[name="create_source"]',function(e){e.preventDefault();var form=$(this),valid=isFormValid(form);if(valid){resetAlert($("#section"));$.ajax({type:"POST",url:form.attr("action"),data:form.serialize()}).done(function(data,textStatus,jqXHR){location.hash=jqXHR.getResponseHeader("Location")}).fail(function(jqXHR){$("body,html").animate({scrollTop:0},"fast");var status_msg=getStatusMsg(jqXHR);showPermanentError(form,status_msg)})}});$("#section").on("submit",'form[name="source"]',function(e){e.preventDefault();var form=$(this),btn=form.find(".btn-primary"),valid=isFormValid(form);if(valid){btn.button("loading");resetAlert($("#section"));$.ajax({type:"POST",url:form.attr("action"),data:form.serialize()}).always(function(){btn.button("reset")}).done(function(data,textStatus,jqXHR){$("#section").fadeOut("fast",function(){$(this).empty();$(this).html(data);$(this).fadeIn("fast",function(){$(".chzn-select").chosen();$("#id").focus()})})}).fail(function(jqXHR){$("body,html").animate({scrollTop:0},"fast");var status_msg=getStatusMsg(jqXHR);showPermanentError(form,status_msg)})}});$("#section").on("click","#sourceRules a:not(.btn-icon)",function(event){var modal=$("#modalRule");var url=$(this).attr("href");var section=$("#section");var loader=section.prev(".loader");loader.show();section.fadeTo("fast",.5);modal.empty();$.ajax(url).always(function(){loader.hide();section.stop();section.fadeTo("fast",1)}).done(function(data){modal.append(data);modal.one("shown",function(){$("#id").focus()});modal.modal({shown:true});var rule_class=$("#class");var actions_table=$("#ruleActions");var action_row=actions_table.children("tbody").children("tr");if(rule_class.find(":selected").attr("value")=="administration"){action_row.find('option[data-rule-class="administration"]').removeClass("hidden");action_row.find('option[data-rule-class="authentication"]').addClass("hidden")}else if(rule_class.find(":selected").attr("value")=="authentication"){action_row.find('option[data-rule-class="authentication"]').removeClass("hidden");action_row.find('option[data-rule-class="administration"]').addClass("hidden")}}).fail(function(jqXHR){$("body,html").animate({scrollTop:0},"fast");var status_msg=getStatusMsg(jqXHR);showError($("#section h3"),status_msg)});return false});$("#section").on("click","#createRule",function(event){var modal=$("#modalRule");var url=$(this).attr("href");var section=$("#section");var loader=section.prev(".loader");loader.show();section.fadeTo("fast",.5);modal.empty();$.ajax(url).always(function(){loader.hide();section.stop();section.fadeTo("fast",1)}).done(function(data){modal.append(data);modal.one("shown",function(){$("#id").focus();$("#class").trigger("change")});modal.modal({shown:true})}).fail(function(jqXHR){$("body,html").animate({scrollTop:0},"fast");var status_msg=getStatusMsg(jqXHR);showError($("#section h3"),status_msg)});return false});$("#section").on("submit",'form[name="rule"]',function(event){var form=$(this),btn=form.find(".btn-primary"),modal=$("#modalRule"),modal_body=modal.find(".modal-body").first(),valid=isFormValid(form);if(valid){btn.button("loading");resetAlert(modal_body);form.find("tr.hidden :input").attr("disabled","disabled");$.ajax({type:"POST",url:form.attr("action"),data:form.serialize()}).always(function(){btn.button("reset")}).done(function(data){modal.one("hidden",function(){$("#sourceRulesEmpty").closest(".control-group").fadeOut("fast",function(){$(this).empty();$(this).html(data);$(this).fadeIn("fast",function(){$(".chzn-select").chosen({width:""})})})});modal.modal("hide")}).fail(function(jqXHR){var status_msg=getStatusMsg(jqXHR);showPermanentError(modal_body.children().first(),status_msg);form.find("tr.hidden :input").removeAttr("disabled")})}return false});$("#section").on("change","#class",function(event){var that=$(this);var table=$("#ruleActions");table.find("tr:not(.hidden)").remove();var row_model=table.children("tbody").children(".hidden").first();if(that.find(":selected").attr("value")=="administration"){row_model.find('option[data-rule-class="administration"]').removeClass("hidden");row_model.find('option[data-rule-class="administration"]').removeAttr("disabled");row_model.find('option[data-rule-class="authentication"]').addClass("hidden");row_model.find('option[data-rule-class="authentication"]').attr("disabled","disabled")}else if(that.find(":selected").attr("value")=="authentication"){row_model.find('option[data-rule-class="authentication"]').removeClass("hidden");row_model.find('option[data-rule-class="authentication"]').removeAttr("disabled");row_model.find('option[data-rule-class="administration"]').addClass("hidden");row_model.find('option[data-rule-class="administration"]').attr("disabled","disabled")}$("#ruleActions tr:not(.hidden) select[name$=type]").each(function(){updateAction($(this),false)});table.trigger("addrow");table.find("tr").find('[href="#delete"]').addClass("hidden")});$("body").on("click",'#ruleConditionsEmpty [href="#add"]',function(event){$("#ruleConditions").trigger("addrow");return false});$("#section").on("show","#modalRule",function(event){if(event.target.id=="modalRule"){$("#templates").find("option").removeAttr("id");$("#ruleConditions tr:not(.hidden) select[name$=attribute]").each(function(){updateCondition($(this))});$("#ruleActions tr:not(.hidden) select[name$=type]").each(function(){updateAction($(this),true)})}});$("#section").on("admin.added","#ruleConditions tr",function(event){var attribute=$(this).find("select[name$=attribute]").first();updateCondition(attribute)});$("#section").on("change","#ruleConditions select[name$=attribute]",function(event){updateCondition($(this))});$("#section").on("change","#ruleActions select[name$=type]",function(event){updateAction($(this))});$("#section").on("admin.added","#ruleActions tr:not(.hidden)",function(event){var type=$(this).find("select[name$=type]").first();updateAction(type)})});function initVariableList(editor){$("#variable_list").on("click",".insert-into-file",function(event){var that=$(this);var content=that.attr("data-content");editor.insert(content);editor.focus();return false})}function initShowLinesCheckBox(editor){var file_editor_show_lines=$("#file-editor-show-lines");var renderer=editor.renderer;file_editor_show_lines.off("click");file_editor_show_lines.click(function(e){renderer.setShowGutter(this.checked);return true});renderer.setShowGutter(file_editor_show_lines.is(":checked"))}function initSaveModal(editor,file_content){var save_modal=$("#saveFile");var save_button=save_modal.find("a.btn-primary").first();save_button.off("click");save_button.click(function(event){var form=$("#file_editor_form");file_content.val(editor.getValue());submitFormHideModal(save_modal,form)})}function initCancelModal(){$("#cancelEdit").find("a.btn-primary").first().click(function(event){window.location=$(this).attr("href")})}function initEditor(editor,file_content){var cancel_link=$("#cancel-link");var file_editor_buttons=$(".form-actions a.btn.editorToggle");var enableButtonsOnChangeOnce=function(e){cancel_link.attr("data-toggle","modal");file_editor_buttons.toggleClass("disabled");editor.removeEventListener("change",enableButtonsOnChangeOnce)};editor.setTheme("ace/theme/monokai");editor.getSession().setMode("ace/mode/html");editor.on("change",enableButtonsOnChangeOnce);editor.focus();$("#rename_file").on("submit",function(){submitFormHideModalGoToLocation($("#renameModal"),$(this));return false});$("#resetContent").find("a.btn-primary").first().click(function(event){editor.setValue(file_content.val(),-1);cancel_link.removeAttr("data-modal");file_editor_buttons.toggleClass("disabled");editor.on("change",enableButtonsOnChangeOnce)})}function initRenameForm(element){var file_name_span=$("#file_name");var input_span=file_name_span.next().first();var link=file_name_span.find("a").first();var width_span=input_span.next().first();var input=input_span.children().first();var rename_form=$("#rename_file");element.on("click","#file_name a",function(event){width_span.html(input.val());input.width(width_span.width()+5);input_span.removeClass("hidden");link.addClass("hidden");input.focus()});$("#new_file_name").keyup(function(event){var input=$(this);if(event.keyCode==27){input.focusout()}else{width_span.html(input.val());input.width(width_span.width()+5)}});$("#new_file_name").focusout(function(event){width_span.html(input.val());input.width(width_span.width()+5);input_span.addClass("hidden");link.removeClass("hidden");rename_form[0].reset()})}function initEditorPage(element){var file_content=$("#file_content");var editor=ace.edit("editor");initVariableList(editor);initShowLinesCheckBox(editor);initSaveModal(editor,file_content);initCancelModal();initEditor(editor,file_content);initRenameForm(element)}function initCollapse(element){element.on("show hidden",".collapse",function(event){var that=$(this);var tr=that.closest("tr").first();tr.swap_class("toggle");var link=element.find('[data-target="#'+that.attr("id")+'"]');link.find("[data-swap]").swap_class("toggle");event.stopPropagation()})}function initCopyModal(element){var modal=$("#copyModal");var button=modal.find(".btn-primary").first();modal.on("shown",function(){$(this).find(":input:first").focus()});modal.on("hidden",function(){$(this).data("modal").$element.removeData()});button.off("click");button.click(function(event){var form=modal.find("#copyModalForm");submitFormHideModal(modal,form)});element.on("submit","#copyModalForm",function(){submitFormHideModal(modal,$(this));return false})}function submitFormHideModalGoToLocation(modal,form){$.ajax({async:false,url:form.attr("action"),type:form.attr("method")||"POST",data:form.serialize()}).always(function(){modal.modal("hide")}).done(function(data,textStatus,jqXHR){location.hash=jqXHR.getResponseHeader("Location")}).fail(function(jqXHR){$("body,html").animate({scrollTop:0},"fast");var status_msg=getStatusMsg(jqXHR);showError($("#section h2"),status_msg)})}function initNewFileModal(element){var modal=$("#newFileModal");var button=modal.find(".btn-primary").first();modal.on("hidden",function(){$(this).data("modal").$element.removeData()});modal.on("shown",function(){$(this).find(":input:first").focus()});button.off("click");button.click(function(event){var form=modal.find("#newFileModalForm");submitFormHideModalGoToLocation(modal,form);return false});element.on("submit","#newFileModalForm",function(){submitFormHideModalGoToLocation(modal,$(this));return false})}function disabledLinks(element){element.on("click",".disabled",function(){return false})}function initIndexPage(element){}function initCreatePage(element){var form=element.find("#create_profile");var saveBtn=form.find(".btn-primary").first();saveBtn.off("click");saveBtn.click(function(event){var valid=isFormValid(form);if(!valid){$("body,html").animate({scrollTop:0},"fast")}return valid});var modal=$("#createProfile");var confirmationBtn=modal.find(".btn-primary").first();confirmationBtn.off("click");confirmationBtn.click(function(event){submitFormHideModalGoToLocation(modal,form);return false});initReadPage(element)}function initReadPage(element){updateDynamicRowsAfterRemove($("#locale"));updateDynamicRowsAfterRemove($("#filter"));$("#locale, #sources").on("admin.added","tr",function(event){var row=$(this);var siblings=row.siblings(":not(.hidden)");var selected_options=siblings.find("select option:selected");var select=row.find("select");select.find("option:selected").removeAttr("selected");var options=select.find('option[value!=""]');options.each(function(index,element){var selector='[value="'+element.value+'"]';if(selected_options.filter(selector).length===0){$(element).attr("selected","selected");return false}});var rows=row.siblings(":not(.hidden)").addBack();if(rows.length==options.length){rows.find('[href="#add"]').addClass("hidden")}});$("#sources").on("change","select",function(event){var that=$(this);var tr=that.closest("tr");if(that.find(":selected").attr("data-source-class")=="exclusive"){tr.siblings(":not(.hidden)").find('[href="#delete"]').click();tr.find('[href="#add"]').addClass("hidden")}else{tr.find('[href="#add"]').removeClass("hidden")}});$("#filter").on("change",'select[name$=".type"]',function(event){var type_input=$(event.currentTarget);updateFilterMatchInput(type_input,false)});$('[id$="Empty"]').on("click",'[href="#add"]',function(event){var match=/(.+)Empty/.exec(event.delegateTarget.id);var id=match[1];var emptyId=match[0];$("#"+id).trigger("addrow");$("#"+emptyId).addClass("hidden");return false});$('select[name$=".type"]:not(:disabled)').each(function(i,e){updateFilterMatchInput($(e),true)})}function updateFilterMatchInput(type_input,keep_value){var match_input=type_input.next();var type_value=type_input.val();var match_input_template_id="#"+type_value+"_filter_match";var match_input_template=$(match_input_template_id);if(match_input_template.length===0){match_input_template=$("#default_filter_match")}if(match_input_template.length){changeInputFromTemplate(match_input,match_input_template,keep_value);if(type_value=="switch"){type_input.next().typeahead({source:searchSwitchesGenerator($("#section h2")),minLength:2,items:11,matcher:function(item){return true}})}}}function initTemplatesPage(element){initCopyModal(element);initCollapse(element);initNewFileModal(element)}function connectionProfileGlobalInit(element){initWidgets(element.find(".chzn-select"));disabledLinks(element)}$("#section").on("section.loaded",function(event){var initializers=[{id:"#connection_profile_file_editor",initializer:initEditorPage},{id:"#connection_profile_files",initializer:initTemplatesPage},{id:"#connection_profile_index",initializer:initIndexPage},{id:"#connection_profile_create",initializer:initCreatePage},{id:"#connection_profile_read",initializer:initReadPage}];for(var i=0;i<initializers.length;i++){var initializer=initializers[i];var element=$(initializer.id);if(element.length){connectionProfileGlobalInit(element);initializer.initializer(element)}}});var domainView;$(function(){var items=new Domains;domainView=new DomainView({items:items,parent:$("#section")})});function Domains(){}Domains.prototype=new Items;Domains.prototype.id="#domains";Domains.prototype.formName="modalDomain";Domains.prototype.modalId="#modalDomain";Domains.prototype.createSelector=".createDomain";function DomainView(options){ItemView.call(this,options);var that=this;this.parent=options.parent;this.items=options.items;var id=this.items.id;options.parent.off("click",id+' [href$="/delete"]');var delete_item=$.proxy(this.deleteItem,this);options.parent.on("click",id+' [href$="/delete"]',delete_item);var save_and_join=$.proxy(this.updateAndJoinDomain,this);options.parent.on("click","#saveAndJoinDomain",save_and_join)}DomainView.prototype=function(){function F(){}F.prototype=ItemView.prototype;return new F}();DomainView.prototype.constructor=ItemView;DomainView.prototype.showWait=function(title){var that=this;$("#modalDomainWait h3").html(title);$("#domainProgressBar").css("width","1%");$("#modalDomainWait").modal("show")};DomainView.prototype.updateAndJoinDomain=function(e){e.preventDefault();var that=this;var target=$(e.target);var form=target.closest("form");var table=$(this.items.id);var btn=form.find(".btn");var modal=form.closest(".modal");var valid=isFormValid(form);if(valid){var modal_body=modal.find(".modal-body").first();resetAlert(modal_body);form.find("tr.hidden :input").attr("disabled","disabled");modal.modal("hide");that.showWait("The server is currently joining the domain");this.items.post({url:target.attr("href"),data:form.serialize(),always:function(){form.find("tr.hidden :input").removeAttr("disabled");btn.button("reset");$("#modalDomainWait").modal("hide")},success:function(data){var content=$("<div></div>");content.append("<h3>Result of the domain join</h3>");content.append($("<pre>"+data.items.join_output+"</pre>"));that.showResultModal(content);that.list()},errorSibling:$("#section")})}};DomainView.prototype.showResultModal=function(title,content){var self=this;$("#modalDomainInfo .modal-header h3").html(title);$("#modalDomainInfo .modal-body").html(content);$("#modalDomainInfo").modal("show")};DomainView.prototype.deleteItem=function(e){var self=this;var original_event=e;e.preventDefault();if($(this).hasClass("disabled"))return false;var link=$(this);var url=link.attr("href");var row=link.closest("tr");var cells=row.find("td");var name=$(cells[1]).text();if(!name)name=$(cells[0]).text();var modal=$("#deleteItem");var confirm_link=modal.find("a.btn-primary").first();modal.find("h3 span").html(name);modal.modal("show");confirm_link.off("click");confirm_link.click(function(e){e.preventDefault();confirm_link.button("loading");e.preventDefault();var table=$(self.items.id);var btn=$(original_event.target);var row=btn.closest("tr");var url=btn.attr("href");self.items.get({url:url,always:function(){confirm_link.button("reset");modal.modal("hide")},success:function(data){showSuccess(table,data.status_msg);self.list(e)},errorSibling:table})})};DomainView.prototype.list=function(){var table=$("#domains");this.listRefresh(table.attr("data-list-uri"))};DomainView.prototype.listRefresh=function(list_url){var table=$("#domains");var that=this;table.fadeTo("fast",.5,function(){that.items.get({url:list_url,always:function(){table.fadeTo("fast",1)},success:function(data){table.replaceWith(data)},errorSibling:$("#domains")})})};DomainView.prototype.setPassword=function(domain,callback){var that=this;var modal=$("#modalDomainSetPassword-"+domain);var form=$("#modalDomainSetPassword-"+domain+" form");form.submit(function(evt){evt.preventDefault();$.ajax({url:form.attr("action"),type:"POST",data:form.serialize()}).done(function(data){modal.modal("hide");form.find('input[name="username"]').val("");form.find('input[name="password"]').val("");callback()}).fail(function(jqXHR){$("body,html").animate({scrollTop:0},"fast");var status_msg=getStatusMsg(jqXHR);form.find('input[name="username"]').val("");form.find('input[name="password"]').val("");showError($("#section h2"),status_msg)});return false});modal.modal("show")};$(document).ready(function(){$("#section").on("click",".rejoin_domain",function(event){var that=this;event.preventDefault();var domain_name=$(event.target).parent().parent().children().children().html();domainView.setPassword(domain_name,function(){var view=domainView;var jbtn=$(that);var initial_content=jbtn.html();jbtn.attr("disabled","disabled");jbtn.html("Rejoining domain");domainView.showWait("The server is rejoining the domain.");$.ajax({url:jbtn.attr("href"),type:"GET"}).done(function(data){$("body,html").animate({scrollTop:0},"fast");var content=$("<div></div>");content.append("<h3>Result of the domain leave</h3>");content.append($("<pre>"+data.items.leave_output+"</pre>"));content.append("<h3>Result of the domain join</h3>");content.append($("<pre>"+data.items.join_output+"</pre>"));$("#modalDomainWait").modal("hide");domainView.showResultModal(content);view.list();jbtn.html(initial_content);jbtn.removeAttr("disabled")}).fail(function(jqXHR){$("body,html").animate({scrollTop:0},"fast");var status_msg=getStatusMsg(jqXHR);showError($("#section h2"),status_msg);jbtn.html(initial_content);jbtn.removeAttr("disabled")})});return false});$("#section").on("click","#refresh_domains",function(event){event.preventDefault();var initial_content=$("#refresh_domains").html();$("#refresh_domains").attr("disabled","disabled");$("#refresh_domains").html("Refreshing domains");domainView.showWait("The server is refreshing the configuration.");$.ajax({url:$("#refresh_domains").attr("href"),type:"GET"}).done(function(data){$("body,html").animate({scrollTop:0},"fast");$("#modalDomainWait").modal("hide");showSuccess($("#section h2"),data.status_msg);$("#refresh_domains").html(initial_content);$("#refresh_domains").removeAttr("disabled")}).fail(function(jqXHR){$("body,html").animate({scrollTop:0},"fast");var status_msg=getStatusMsg(jqXHR);showError($("#section h2"),status_msg);$("#refresh_domains").html(initial_content);$("#refresh_domains").removeAttr("disabled")})});setInterval(function(){var width=$("#domainProgressBar").width();if(!width&&width!==0)return;var parentWidth=$("#domainProgressBar").offsetParent().width();width=100*width/parentWidth;if(width==100){width=0}else{width+=10;if(width>100){width=100}}$("#domainProgressBar").css("width",width+"%")},15e3)});var filtersView;$(function(){filtersView=new FiltersView({parent:$("#section")})});var FiltersView=function(options){var that=this;this.parent=options.parent;var update=$.proxy(this.update,this);options.parent.on("submit","#filtersForm",update);var revert=$.proxy(this.revert,this);options.parent.on("click","#filtersRevert",revert);var load=$.proxy(this.setupEditor,this);options.parent.on("section.loaded",load)};FiltersView.prototype.setupEditor=function(){if($("#editor").length){this.editor=ace.edit("editor");this.editor.setTheme("ace/theme/monokai");this.editor.getSession().setMode("ace/mode/perl");this.disableButtons();this.initialValue=this.editor.getValue()}};FiltersView.prototype.revert=function(e){this.editor.setValue(this.initialValue,-1);this.disableButtons()};FiltersView.prototype.disableButtons=function(){$("#filtersForm .btn").addClass("disabled");this.enableButtonsProxy=$.proxy(this.enableButtons,this);this.editor.on("change",this.enableButtonsProxy)};FiltersView.prototype.enableButtons=function(){$("#filtersForm .btn").removeClass("disabled");this.editor.removeEventListener("change",this.enableButtonsProxy)};FiltersView.prototype.update=function(e){var that=this;e.preventDefault();var jthis=$(e.target);$.ajax({url:jthis.attr("action"),type:"POST",data:{content:this.editor.getValue()}}).done(function(data){showSuccess(jthis,data.status_msg);that.initialValue=that.editor.getValue();that.disableButtons()}).fail(function(jqXHR){var status_msg=getStatusMsg(jqXHR);showPermanentError(jthis,status_msg)});return false};$(function(){var items=new FingerbankDevices;var view=new FingerbankDeviceView({items:items,parent:$("#section")})});var FingerbankDevices=function(){};FingerbankDevices.prototype=new Items;FingerbankDevices.prototype.id="#fingerbankdevices";FingerbankDevices.prototype.formName="modalFingerbankDevice";FingerbankDevices.prototype.modalId="#modalFingerbankDevice";FingerbankDevices.prototype.createSelector=".createFingerbankDevice";var FingerbankDeviceView=function(options){ItemView.call(this,options);var that=this;var showChildren=$.proxy(this.showChildren,this);options.parent.on("click",'#fingerbankdevices [href$="/children"]',showChildren);var read=$.proxy(this.readItem,this);options.parent.on("click",'#fingerbankdevices [href$="/add_child"]',read);options.parent.on("show hidden",".collapse",function(event){var that=$(this);var tr=that.closest("tr").first();tr.toggleClass("hidden");event.stopPropagation()})};FingerbankDeviceView.prototype=function(){function F(){}F.prototype=ItemView.prototype;return new F}();FingerbankDeviceView.prototype.constructor=FingerbankDeviceView;FingerbankDeviceView.prototype.showChildren=function(e){var that=this;var link=$(e.currentTarget);var href=link.attr("href");var target=link.attr("data-target");var children_div=$(target);var row=children_div.closest("tr");children_div.collapse({toggle:false});if(row.hasClass("hidden")){this.items.get({url:href,success:function(data){children_div.find("table").html(data);children_div.collapse("show")},errorSibling:$(that.id)})}else{children_div.collapse("hide")}return false};$(function(){$("#section").on("submit","#fingerbankonboard",function(event){updateSectionFromForm($("#fingerbankonboard"));return false})});$(function(){var items=new FloatingDevices;var view=new FloatingDeviceView({items:items,parent:$("#section")})});var FloatingDevices=function(){};FloatingDevices.prototype=new Items;FloatingDevices.prototype.id="#floatingdevices";FloatingDevices.prototype.formName="modalFloatingDevice";FloatingDevices.prototype.modalId="#modalFloatingDevice";FloatingDevices.prototype.createSelector=".createFloatingDevice";var FloatingDeviceView=function(options){ItemView.call(this,options);var that=this;this.parent=options.parent;this.items=options.items;options.parent.on("change",'form[name="modalFloatingDevice"] input[name="trunkPort"]',this.toggleTaggedVlan);options.parent.on("show","#modalFloatingDevice",function(e){var checkbox=$('form[name="modalFloatingDevice"] input[name="trunkPort"]').first();$.proxy(that.toggleTaggedVlan,checkbox)(e)})};FloatingDeviceView.prototype=function(){function F(){}F.prototype=ItemView.prototype;return new F}();FloatingDeviceView.prototype.constructor=FloatingDeviceView;FloatingDeviceView.prototype.toggleTaggedVlan=function(e){var checkbox=$(this);var taggedVlan=checkbox.closest("form").find('input[name="taggedVlan"]').first();if(checkbox.is(":checked"))taggedVlan.removeAttr("disabled");else taggedVlan.attr("disabled",1)};$(function(){var interfaces=new Interfaces;var view=new InterfaceView({interfaces:interfaces,parent:$("#section")});var read=$.proxy(view.readInterface,view);$("#section").on("click","#createNetwork",read)});$(function(){var items=new Items;var view=new ItemView({items:items,parent:$("#section")})});function Items(){}Items.prototype.id="#items";Items.prototype.formName="modalItem";Items.prototype.modalId="#modalItem";Items.prototype.createSelector=".createItem";Items.prototype.get=function(options){$.ajax({url:options.url}).always(options.always).done(options.success).fail(function(jqXHR){var status_msg=getStatusMsg(jqXHR);showPermanentError(options.errorSibling,status_msg)})};Items.prototype.post=function(options){$.ajax({url:options.url,type:"POST",data:options.data}).always(options.always).done(options.success).fail(function(jqXHR){var status_msg=getStatusMsg(jqXHR);showPermanentError(options.errorSibling,status_msg)})};function ItemView(options){var that=this;this.parent=options.parent;var items=options.items;this.items=items;this.disableToggle=false;var id=items.id;var formName=items.formName;var read=$.proxy(this.readItem,this);options.parent.on("click",id+' .item [href$="/read"]',read);options.parent.on("click",id+' [href$="/clone"]',read);options.parent.on("click",items.createSelector,read);var update=$.proxy(this.updateItem,this);options.parent.on("submit",'form[name="'+formName+'"]',update);var delete_item=$.proxy(this.deleteItem,this);options.parent.on("click",id+' [href$="/delete"]',delete_item);var list_items=$.proxy(this.listItems,this);options.parent.on("click",id+' [href*="/list"]',list_items);var search=$.proxy(this.search,this);options.parent.on("submit",'form[name="search"]',search);var resetSearch=$.proxy(this.resetSearch,this);options.parent.on("reset",'form[name="search"]',resetSearch);var search_next=$.proxy(this.searchNext,this);options.parent.on("click",id+' [href*="/search"]',search_next)}ItemView.prototype.readItem=function(e){e.preventDefault();var that=this;var modal=$(this.items.modalId);var section=$("#section");var target=e.target;if(target.nodeName!="A")target=target.parentNode;section.loader();section.fadeTo("fast",.5);modal.empty();$(".chosen-drop").remove();this.items.get({url:$(target).attr("href"),always:function(){section.stop();section.fadeTo("fast",1,function(){section.loader("hide")})},success:function(data){modal.append(data);modal.find(".chzn-select").chosen({width:""});modal.find(".chzn-deselect").chosen({allow_single_deselect:true,width:""});fixChosenClipping(modal.find(".chzn-select, .chzn-deselect"));modal.one("shown",function(){modal.find(":input:visible").first().focus()});modal.modal({shown:true})},errorSibling:section.find("h2").first()})};ItemView.prototype.updateItem=function(e){e.preventDefault();var that=this;var form=$(e.target);var table=$(this.items.id);var btn=form.find(".btn-primary");var modal=form.closest(".modal");var valid=isFormValid(form);if(valid){var modal_body=modal.find(".modal-body").first();resetAlert(modal_body);btn.button("loading");form.find("tr.hidden :input").attr("disabled","disabled");this.items.post({url:form.attr("action"),data:form.serialize(),always:function(){form.find("tr.hidden :input").removeAttr("disabled");btn.button("reset")},success:function(data){modal.modal("toggle");showSuccess(table,data.status_msg);that.list()},errorSibling:modal_body.children().first()})}};ItemView.prototype.list=function(){var table=$(this.items.id);this.items.get({url:table.attr("data-list-uri"),success:function(data){table.html(data)},errorSibling:table})};ItemView.prototype.deleteItem=function(e){e.preventDefault();var table=$(this.items.id);var btn=$(e.target);var that=this;var row=btn.closest("tr");var url=btn.attr("href");this.items.get({url:url,success:function(data){showSuccess(table,data.status_msg);that.list(e)},errorSibling:table});return false};ItemView.prototype.list=function(){var table=$(this.items.id);this.listRefresh(table.attr("data-list-uri"))};ItemView.prototype.listItems=function(e){e.preventDefault();var link=$(e.target);this.listRefresh(link.attr("href"))};ItemView.prototype.listRefresh=function(list_url){var table=$(this.items.id);var that=this;table.fadeTo("fast",.5,function(){that.items.get({url:list_url,always:function(){table.fadeTo("fast",1)},success:function(data){table.replaceWith(data)},errorSibling:table})})};ItemView.prototype.resetSearch=function(e){e.preventDefault();this.list();return false};ItemView.prototype.search=function(e){e.preventDefault();var form=$(e.target);var url=form.attr("action");this.searchRefresh(url,form);return false};ItemView.prototype.searchNext=function(e){e.preventDefault();var form=$("#search");var link=$(e.target);var url=link.attr("href");this.searchRefresh(url,form);return false};ItemView.prototype.searchRefresh=function(search_url,form){var table=$(this.items.id);var that=this;table.fadeTo("fast",.5,function(){that.items.post({url:search_url,data:form.serialize(),always:function(){table.fadeTo("fast",1)},success:function(data){table.replaceWith(data)},errorSibling:table})});return false};$(function(){var items=new Pfdetects;var view=new PfdetectView({items:items,parent:$("#section")})});var Pfdetects=function(){};Pfdetects.prototype=new Items;Pfdetects.prototype.id="#pfdetects";Pfdetects.prototype.formName="modalPfdetect";Pfdetects.prototype.modalId="#modalPfdetect";Pfdetects.prototype.createSelector=".createPfdetect";var PfdetectView=function(options){ItemView.call(this,options);var that=this;this.parent=options.parent;var items=options.items;this.items=items;var id=items.id;var formName=items.formName;options.parent.off("click",id+' [href$="/clone"]');var showTestRegex=$.proxy(this.showTestRegex,this);options.parent.on("show","#test-regex",showTestRegex);var toggleResults=$.proxy(this.toggleResults,this);options.parent.on("shown","#test-regex-results .collapse",toggleResults);options.parent.on("hidden","#test-regex-results .collapse",toggleResults);var testRegex=$.proxy(this.testRegex,this);options.parent.on("click","#test-regex-btn",testRegex);var handleChangeApiMethod=this.handleChangeApiMethod;options.parent.on("change",'form[name="modalPfdetect"] [name$=".api_method"]',handleChangeApiMethod)};PfdetectView.prototype=function(){function F(){}F.prototype=ItemView.prototype;return new F}();PfdetectView.prototype.constructor=PfdetectView;PfdetectView.prototype.updateItem=function(e){e.preventDefault();var that=this;var form=$(e.target);var table=$(this.items.id);var section=$("#section");var btn=form.find(".btn-primary");var valid=isFormValid(form);if(valid){var alert_element=form.find("h2").first();btn.button("loading");this.items.post({url:form.attr("action"),data:form.serialize(),always:function(){btn.button("reset")},success:function(data,textStatus,jqXHR){var redirect=jqXHR.getResponseHeader("Location");showSuccess(alert_element,data.status_msg);if(redirect){location.hash=redirect}},errorSibling:alert_element})}};PfdetectView.prototype.toggleResults=function(e){var div=$(e.currentTarget);var icon=$('a[data-target="#'+div.attr("id")+'"] i');if(icon.length){icon.toggleClass("icon-minus-circle",1)}};PfdetectView.prototype.testRegex=function(e){e.preventDefault();var that=this;var btn=$(e.target);var form=$(btn.closest("form").first());var valid=isFormValid(form);if(valid){var action=btn.attr("data-test-action");var section=$("#section");btn.button("loading");this.items.post({url:action,data:form.serialize(),always:function(){btn.button("reset")},success:function(data){showSuccess(section.find("h2").first(),"Passed");$("#test-regex-results").html(data)},errorSibling:section.find("h2").first()})}return false};PfdetectView.prototype.showTestRegex=function(e){$('textarea[name="loglines"]').removeAttr("disabled")};PfdetectView.prototype.handleChangeApiMethod=function(e){var search_input=$(e.currentTarget);var api_parameters_input=search_input.next();var search_type=search_input.val();var api_parameters_id="#"+search_type+"_api_parameters";var api_parameters_template=$(api_parameters_id);if(api_parameters_template.length===0){api_parameters_template=$("#default_api_parameters")}if(api_parameters_template.length){changeInputFromTemplate(api_parameters_input,api_parameters_template)}};function submitFormGoToLocation(form){$.ajax({async:false,url:form.attr("action"),type:form.attr("method")||"POST",data:form.serialize()}).done(function(data,textStatus,jqXHR){location.hash=jqXHR.getResponseHeader("Location")}).fail(function(jqXHR){$("body,html").animate({scrollTop:0},"fast");var status_msg=getStatusMsg(jqXHR);showError($("#section h2"),status_msg)})}$("#section").on("click",'[id$="Empty"]',function(event){event.preventDefault();var match=/(.+)Empty/.exec($(event.target).closest(".unwell").attr("id"));var id=match[1];var emptyId=match[0];$("#"+id).trigger("addrow");$("#"+emptyId).addClass("hidden");return false});$("#section").on("submit",'form[name="formItem"]',function(e){e.preventDefault();var form=$(this),btn=form.find(".btn-primary"),valid=isFormValid(form);$('select[name$=".type"]:not(:disabled)').each(function(i,e){if($(e).val()=="Select an option"){valid=false;showPermanentError(form,"Please select a valid action.")}});if(valid){btn.button("loading");resetAlert($("#section"));$.ajax({type:"POST",url:form.attr("action"),data:form.serialize()}).always(function(){btn.button("reset")}).done(function(data,textStatus,jqXHR){showSuccess(form,"Saved");window.location.hash="#config/portal_module/"+form.find('input[name="id"]').val()+"/read"}).fail(function(jqXHR){$("body,html").animate({scrollTop:0},"fast");var status_msg=getStatusMsg(jqXHR);showPermanentError(form,status_msg)})}});$("#section").on("click",".delete-portal-module",function(e){e.preventDefault();var button=$(e.target);button.button("loading");$.ajax({type:"GET",url:button.attr("href")}).always(function(){}).done(function(data,textStatus,jqXHR){showSuccess(button.closest(".table"),"Deleted");button.closest("tr").remove()}).fail(function(jqXHR){button.button("reset");$("body,html").animate({scrollTop:0},"fast");var status_msg=getStatusMsg(jqXHR);showPermanentError(button.closest(".table"),status_msg)});return false});$("#section").on("click",".expand",function(e){e.preventDefault();$(e.target).hide(function(){$($(e.target).attr("data-expand")).slideDown()});return false});$("#section").on("change",'#actions select[name$=".type"]',function(event){var type_input=$(event.currentTarget);updateActionMatchInput(type_input,false)});$("#section").on("click",'#actionsContainer a[href="#add"]',function(event){setTimeout(initActionMatchInput,3e3)});$("#section").on("section.loaded",function(event){var dataEl=document.getElementById("modulesTreeData");if(dataEl){var data=JSON.parse(dataEl.textContent||dataEl.innerHTML);$("#modulesTree").tree({data:data});$("#modulesTree").bind("tree.click",function(event){var node=event.node;window.location.hash="#config/portal_module/"+node.id+"/read"})}initActionMatchInput()});function initActionMatchInput(){$('select[name$=".type"]:not(:disabled)').each(function(i,e){updateActionMatchInput($(e),true)})}function updateActionMatchInput(type_input,keep){var match_input=type_input.next();var type_value=type_input.val();var match_input_template_id="#"+type_value+"_action_match";var match_input_template=$(match_input_template_id);if(match_input_template.length===0){match_input_template=$("#default_action_match")}if(match_input_template.length){changeInputFromTemplate(match_input,match_input_template,keep);if(type_value=="switch"){type_input.next().typeahead({source:searchSwitchesGenerator($("#section h2")),minLength:2,items:11,matcher:function(item){return true}})}}}$(function(){var items=new Provisioners;var view=new ProvisionerView({items:items,parent:$("#section")})});var Provisioners=function(){};Provisioners.prototype=new Items;Provisioners.prototype.id="#provisioners";Provisioners.prototype.formName="modalProvisioner";Provisioners.prototype.modalId="#modalProvisioner";Provisioners.prototype.createSelector=".createProvisioner";var ProvisionerView=function(options){ItemView.call(this,options);var that=this;this.parent=options.parent;this.items=options.items;var toggleInputs=$.proxy(this.toggleInputs,this);options.parent.on("change",'form[name="modalProvisioner"] select[name="security_type"]',toggleInputs);options.parent.on("change",'form[name="modalProvisioner"] select[name="eap_type"]',toggleInputs);options.parent.on("show","#modalProvisioner",toggleInputs)};ProvisionerView.prototype=function(){function F(){}F.prototype=ItemView.prototype;return new F}();ProvisionerView.prototype.constructor=ProvisionerView;ProvisionerView.prototype.toggleInputs=function(e){this.togglePkiProvider(e);this.toggleWifiKey(e);this.toggleEapType(e);this.toggleServerCertificate(e)};ProvisionerView.prototype.toggleWifiKey=function(e){var security_type=$("#security_type option:selected").text();var eap_type=$("#eap_type option:selected").text();var passcode_input=$("#passcode").closest(".control-group");if(security_type!="Open"&&eap_type=="No EAP"){passcode_input.show()}else{passcode_input.hide()}};ProvisionerView.prototype.toggleEapType=function(e){var security_type=$("#security_type option:selected").text();var eap_input=$("#eap_type").closest(".control-group");if(security_type=="WPA2"){eap_input.show()}else{eap_input.hide()}};ProvisionerView.prototype.togglePkiProvider=function(e){var security_type=$("#security_type option:selected").text();var eap_type=$("#eap_type option:selected").text();var pki_input=$("#pki_provider").closest(".control-group");if(security_type=="WPA2"&&eap_type=="EAP-TLS"){pki_input.show()}else{pki_input.hide()}};ProvisionerView.prototype.toggleServerCertificate=function(e){var security_type=$("#security_type option:selected").text();var eap_type=$("#eap_type option:selected").text();var server_certificate=$("#server_certificate_path").closest(".control-group");if(security_type=="WPA2"&&eap_type=="PEAP"){server_certificate.show()}else{server_certificate.hide()}};$("#section").on("click",'[href*="#modalRole"]',function(event){var modal=$("#modalRole");var url=$(this).attr("href");var section=$("#section");var loader=section.prev(".loader");loader.show();section.fadeTo("fast",.5);modal.empty();$.ajax(url).always(function(){loader.hide();section.stop();section.fadeTo("fast",1)}).done(function(data){modal.append(data);modal.one("shown",function(){$("#name").focus()});modal.modal({shown:true})}).fail(function(jqXHR){$("body,html").animate({scrollTop:0},"fast");var status_msg=getStatusMsg(jqXHR);showError($("#section table"),status_msg)});return false});$("#section").on("click","#createRole",function(event){var modal=$("#modalRole");var url=$(this).attr("href");var section=$("#section");var loader=section.prev(".loader");loader.show();section.fadeTo("fast",.5);modal.empty();$.ajax(url).always(function(){loader.hide();section.stop();section.fadeTo("fast",1)}).done(function(data){modal.append(data);modal.one("shown",function(){$("#name").focus();$(".chzn-select").chosen({width:""});$(".chzn-deselect").chosen({allow_single_deselect:true,width:""})});modal.modal({shown:true})}).fail(function(jqXHR){$("body,html").animate({scrollTop:0},"fast");var status_msg=getStatusMsg(jqXHR);showError($("#section table"),status_msg)});return false});$("body").on("submit",'form[name="role"]',function(event){var form=$(this),modal=$("#modalRole"),modal_body=modal.find(".modal-body"),valid=isFormValid(form);if(valid){resetAlert(modal_body);$.ajax({type:"POST",url:form.attr("action"),data:form.serialize()}).done(function(){modal.on("hidden",function(){$(window).hashchange()});modal.modal("hide")}).fail(function(jqXHR){var status_msg=getStatusMsg(jqXHR);resetAlert(modal_body);showPermanentError(modal_body.children().first(),status_msg)})}return false});$(function(){var items=new ScanWMIRules;var view=new ScanWMIRuleView({items:items,parent:$("#section")})});var ScanWMIRules=function(){};ScanWMIRules.prototype=new Items;var ScanWMIRuleView=function(options){var that=this;this.parent=options.parent;this.items=options.items;options.parent.on("click",'#wmi_rulesEmpty [href="#add"]',function(event){$("#wmi_rules").trigger("addrow");$("#wmi_rulesEmpty").addClass("hidden");return false})};$(function(){var items=new Sources;var view=new SourceView({items:items,parent:$("#section")})});var Sources=function(){};Sources.prototype=new Items;Sources.prototype.id="#sources";Sources.prototype.formName="modalSource";Sources.prototype.modalId="#modalSource";var SourceView=function(options){ItemView.call(this,options);var that=this;var items=options.items;var id=items.id;var formName=items.formName;var formSelector='form[name="'+formName+'"]';options.parent.off("click",id+' [href$="/clone"]');options.parent.off("click",id+' [href$="/delete"]');options.parent.on("click","#testSourceBtn",$.proxy(this.testSource,this));options.parent.on("change",formSelector+' select[name*="\\.conditions\\."][name$=".attribute"]',$.proxy(this.changeCondition,this));options.parent.on("change",formSelector+' select[name*="\\.actions\\."][name$=".type"]',$.proxy(this.changeAction,this));options.parent.on("section.loaded",$.proxy(this.loadSource,this));options.parent.on("dynamic-list.add",'div[id^="accordion\\.group\\.administration_rules\\."]',$.proxy(this.addRule,this));options.parent.on("dynamic-list.add",'div[id^="accordion\\.group\\.authentication_rules\\."]',$.proxy(this.addRule,this));options.parent.on("dynamic-list.add",'div[id*="\\.actions\\."]',$.proxy(this.addAction,this));options.parent.on("dynamic-list.add",'div[id*="\\.conditions\\."]',$.proxy(this.addCondition,this));options.parent.on("dynamic-list.ordered",id+" #internal-sources tbody",$.proxy(this.sortItems,this))};SourceView.prototype=function(){function F(){}F.prototype=ItemView.prototype;return new F}();SourceView.prototype.addCondition=function(e){e.stopPropagation();var condition=$(e.target);updateSoureRuleCondition(condition.find('select[name*="\\.conditions\\."][name$=".attribute"]'),true);return false};SourceView.prototype.addAction=function(e){e.stopPropagation();var action=$(e.target);updateAction(action.find('select[name*="\\.actions\\."][name$=".type"]'),true);return false};SourceView.prototype.addRule=function(e){var rule=$(e.target);rule.find('select[name*="\\.actions\\."][name$=".type"]:not(.disabled)').each(function(){updateAction($(this),true)})};SourceView.prototype.loadSource=function(e){var formName=this.items.formName;$("#action_templates").find("option").removeAttr("id");$('form[name="'+formName+'"] select[name*="\\.conditions\\."][name$=".attribute"]:not(.disabled)').each(function(){updateSoureRuleCondition($(this),true)});$('form[name="'+formName+'"] select[name*="\\.actions\\."][name$=".type"]:not(.disabled)').each(function(){updateAction($(this),true)})};SourceView.prototype.changeAction=function(e){updateAction($(e.target),false)};SourceView.prototype.changeCondition=function(e){updateSoureRuleCondition($(e.target),false)};SourceView.prototype.testSource=function(e){e.preventDefault();var btn=$(e.target);var form=btn.closest("form");var valid=isFormValid(form);resetAlert($("#section"));if(valid){this.items.post({url:btn.attr("href"),data:form.serialize(),always:function(){btn.button("reset")},success:function(data,textStatus,jqXHR){showSuccess(form,data.status_msg)},errorSibling:form})}};SourceView.prototype.sortItems=function(e){var form=$(e.target).closest("form");this.items.post({url:form.attr("action"),data:form.serialize(),success:function(data,textStatus,jqXHR){showSuccess(form,data.status_msg)},errorSibling:form})};SourceView.prototype.updateItem=function(e){e.preventDefault();var that=this;var form=$(e.target);var btn=form.find(".btn-primary");var valid=isFormValid(form);if(valid){btn.button("loading");resetAlert($("#section"));this.items.post({url:form.attr("action"),data:form.serialize(),always:function(){$("body,html").animate({scrollTop:0},"fast");btn.button("reset")},success:function(data,textStatus,jqXHR){var redirect=jqXHR.getResponseHeader("Location");if(redirect){location.hash=jqXHR.getResponseHeader("Location")}else{showSuccess(form,data.status_msg)}},errorSibling:form})}};SourceView.prototype.constructor=SourceView;$(function(){var switches=new Switches;var view=new SwitchView({switches:switches,parent:$("#section")})});var Switches=function(){};Switches.prototype.get=function(options){$.ajax({url:options.url}).always(options.always).done(options.success).fail(function(jqXHR){var status_msg=getStatusMsg(jqXHR);showPermanentError(options.errorSibling,status_msg)})};Switches.prototype.post=function(options){$.ajax({url:options.url,type:"POST",data:options.data}).always(options.always).done(options.success).fail(function(jqXHR){var status_msg=getStatusMsg(jqXHR);showPermanentError(options.errorSibling,status_msg)})};var SwitchView=function(options){var that=this;this.parent=options.parent;this.switches=options.switches;this.disableToggle=false;var read=$.proxy(this.readSwitch,this);options.parent.on("click",'#switches [href$="/read"], #switches [href$="/clone"], .createSwitch',read);var import_csv=$.proxy(this.importSwitch,this);options.parent.on("submit",'form[name="modalSwitchImport"]',import_csv);var update=$.proxy(this.updateSwitch,this);options.parent.on("submit",'form[name="modalSwitch"]',update);var delete_s=$.proxy(this.deleteConfirm,this);options.parent.on("click",'#switches [href$="/delete"]',delete_s);var remove_group=$.proxy(this.removeGroup,this);options.parent.on("click",'form[name="modalSwitch"] [href$="/remove_group"]',remove_group);var add_to_group=$.proxy(this.addToGroup,this);options.parent.on("click",'form[name="modalSwitch"] #addNewMember',add_to_group);options.parent.on("change",'form[name="modalSwitch"] input[name="uplink_dynamic"]',this.changeDynamicUplinks);options.parent.on("change",'form[name="modalSwitch"] input[type="checkbox"][name*="Map"]',this.changeRoleMapping);options.parent.on("click",'#inlineTriggerEmpty [href="#add"]',this.addInlineTrigger);options.parent.on("show","#modalSwitch",function(e){$("#inlineTrigger tr:not(.hidden) select").each(function(){that.updateInlineTrigger($(this))});options.parent.find('#newMember[data-provide="typeahead"]').typeahead({source:$.proxy(that.searchSwitch,that),minLength:2,items:11,matcher:function(item){return true}})});options.parent.on("admin.added","#inlineTrigger tr",function(e){var attribute=$(this).find("select").first();that.updateInlineTrigger(attribute)});options.parent.on("change","#inlineTrigger select",function(e){that.updateInlineTrigger($(this))});var pagination=$.proxy(this.pagination,this);options.parent.on("click",'#switches [href*="/list"]',pagination);options.parent.on("submit","#switches #search",$.proxy(this.submitSearch,this));options.parent.on("reset","#switches #search",$.proxy(this.resetSearch,this));options.parent.on("click",'#switches [href*="/switch/search"]',$.proxy(this.searchPagination,this));options.parent.on("click","#invalidate_cache",$.proxy(this.invalidateCache,this))};SwitchView.prototype.readSwitch=function(e){e.preventDefault();var that=this;var modal=$("#modalSwitch");var section=$("#section");var loader=section.prev(".loader");loader.show();section.fadeTo("fast",.5);modal.empty();$(".chzn-drop").remove();this.switches.get({url:$(e.target).attr("href"),always:function(){loader.hide();section.stop();section.fadeTo("fast",1)},success:function(data){modal.append(data);modal.find(".chzn-select").chosen({width:""});modal.find(".chzn-deselect").chosen({allow_single_deselect:true,width:""});modal.one("shown",function(){var checkbox;modal.find(":input:visible").first().focus();checkbox=$('form[name="modalSwitch"] input[name="uplink_dynamic"]');that.changeDynamicUplinks.call(checkbox);checkbox=$('form[name="modalSwitch"] input[type="checkbox"][name*="Map"]');checkbox.each(function(i){that.changeRoleMapping.call(this)})});modal.modal({shown:true})},errorSibling:section.find("h2").first()})};SwitchView.prototype.changeRoleMapping=function(e){var checkbox=$(this);var match=/(.+)Map/.exec(checkbox.attr("name"));var type=match[1];var inputs=$.merge(checkbox.closest("form").find('input[type="text"][name*="'+type+'"]'),checkbox.closest("form").find('textarea[name*="'+type+'"]'));if(checkbox.is(":checked"))inputs.removeAttr("disabled");else inputs.attr("disabled",1)};SwitchView.prototype.changeDynamicUplinks=function(e){var checkbox=$(this);var uplinks=checkbox.closest("form").find('input[name="uplink"]').first();if(checkbox.is(":checked"))uplinks.attr("disabled",1);else uplinks.removeAttr("disabled")};SwitchView.prototype.addInlineTrigger=function(e){var tbody=$("#inlineTrigger").children("tbody");var row_model=tbody.children(".hidden").first();if(row_model){$("#inlineTriggerEmpty").addClass("hidden");var row_new=row_model.clone();row_new.removeClass("hidden");row_new.insertBefore(row_model);row_new.trigger("admin.added")}return false};SwitchView.prototype.updateInlineTrigger=function(attribute){var trigger=attribute.find(":selected").val();var value=attribute.next();if(trigger!=value.attr("data-trigger")){value.attr("disabled",1);var value_new=$("#"+trigger+"_trigger").clone();value_new.attr("id",value.attr("id"));value_new.attr("name",value.attr("name"));value_new.insertBefore(value);if(!value.attr("data-trigger")){value_new.val(value.val())}value.remove();value_new.attr("data-trigger",trigger)}};SwitchView.prototype.updateSwitch=function(e){e.preventDefault();var that=this;var form=$(e.target);var btn=form.find(".btn-primary");var modal=form.closest(".modal");var valid=isFormValid(form);if(valid){var modal_body=modal.find(".modal-body").first();resetAlert(modal_body);btn.button("loading");form.find("tr.hidden :input").attr("disabled","disabled");this.switches.post({url:form.attr("action"),data:form.serialize(),always:function(){form.find("tr.hidden :input").removeAttr("disabled");btn.button("reset")},success:function(data){modal.modal("toggle");showSuccess(that.parent.find(".table.items").first(),data.status_msg);that.refreshTable()},errorSibling:modal_body.children().first()})}};SwitchView.prototype.importSwitch=function(e){var that=this;var form=$(e.target);var iform=$("#iframe_form");var btn=form.find(".btn-primary");var modal=form.closest(".modal");btn.button("loading");iform.one("load",function(event){btn.button("reset");var body=$(this).contents().find("body");var text=body.find("textarea").val();modal.modal("hide");showPermanentSuccess($("#switches"),text)})};SwitchView.prototype.addToGroup=function(e){e.preventDefault();var that=this;var button=$(e.target);var newMemberId=$("#newMember").val();this.switches.get({url:"/config/switch/"+newMemberId+"/add_to_group/"+button.attr("data-group"),success:function(data){that.readSwitch({preventDefault:function(){},target:{href:"/config/switchgroup/"+button.attr("data-group")+"/read?tab=switchGroupMembers"}});showSuccess($("#modalSwitch .modal-body").children().first(),data.status_msg)},errorSibling:$("#modalSwitch .modal-body").children().first()})};SwitchView.prototype.removeGroup=function(e){e.preventDefault();var that=this;var a=$(e.target);this.switches.get({url:a.attr("href"),success:function(data){a.closest(".switchGroupMember").remove();if($(".switchGroupMember").size()===0){$("#switchMembersEmpty").closest("tr").removeClass("hidden")}showSuccess($("#modalSwitch .modal-body").children().first(),data.status_msg)},errorSibling:$("#modalSwitch .modal-body").children().first()})};SwitchView.prototype.list=function(){this.switches.get({url:"/config/switch/list",success:function(data){var table=$("#switches");table.html(data)},errorSibling:$("#switches")})};SwitchView.prototype.refreshPage=function(){var that=this;var pagination=$(".pagination").first();var formId=pagination.attr("data-from-form")||"#search";var form=$(formId);var link=pagination.find("li.disabled a[href]").first();if(form.length===0){form=$("#search")}var columns=$("#columns");var href=link.attr("href");var section=$("#section");var status_container=$("#section").find("h2").first();var loader=section.prev(".loader");loader.show();section.fadeTo("fast",.5);section.fadeTo("fast",.5,function(){that.switches.post({url:href,data:form.serialize()+"&"+columns.serialize(),always:function(){loader.hide();section.fadeTo("fast",1)},success:function(data){section.html(data)},errorSibling:status_container})});return false};SwitchView.prototype.refreshTable=function(){var that=this;var pagination=$(".pagination").first();var formId=pagination.attr("data-from-form")||"#search";var form=$(formId);var link=pagination.find("li.disabled a[href]").first();if(form.length===0){form=$("#search")}var columns=$("#columns");var href=link.attr("href");var section=$("#section");var status_container=$("#section").find("h2").first();var table=$("#switches");var loader=section.prev(".loader");loader.show();section.fadeTo("fast",.5,function(){that.switches.post({url:href,data:form.serialize()+"&"+columns.serialize(),always:function(){loader.hide();section.fadeTo("fast",1)},success:function(data){table.html(data)},errorSibling:status_container})});return false};SwitchView.prototype.pagination=function(e){e.preventDefault();var link=$(e.target);var url=link.attr("href");var section=$("#section");var loader=section.prev(".loader");loader.show();section.fadeTo("fast",.5);this.switches.get({url:url,always:function(){loader.hide();section.stop();section.fadeTo("fast",1)},success:function(data){var table=$("#switches");table.html(data)},errorSibling:$("#switches")});return false};SwitchView.prototype.searchPagination=function(e){e.preventDefault();var link=$(e.currentTarget);var form=$("#search");var href=link.attr("href");this.refreshListFromForm(href,form);return false};SwitchView.prototype.refreshListFromForm=function(href,form){var that=this;var section=$("#section");$("body,html").animate({scrollTop:0},"fast");var status_container=$("#section").find("h2").first();var loader=section.prev(".loader");loader.show();section.fadeTo("fast",.5,function(){that.switches.post({url:href,data:form.serialize(),always:function(){loader.hide();section.fadeTo("fast",1)},success:function(data){var table=$("#switches");table.html(data)},errorSibling:status_container})});return false};SwitchView.prototype.submitSearch=function(e){e.preventDefault();var that=this;var form=$(e.currentTarget);var href=form.attr("action");this.refreshListFromForm(href,form);return false};SwitchView.prototype.resetSearch=function(e){var that=this;var section=$("#section");$("body,html").animate({scrollTop:0},"fast");var status_container=$("#section").find("h2").first();var loader=section.prev(".loader");loader.show();section.fadeTo("fast",.5,function(){that.switches.post({url:"/config/switch/list",always:function(){loader.hide();section.fadeTo("fast",1)},success:function(data){var table=$("#switches");table.html(data)},errorSibling:status_container})});return true};SwitchView.prototype.deleteConfirm=function(e){e.preventDefault();var that=this;var btn=$(e.target);var row=btn.closest("tr");var url=btn.attr("href");var modal=$("#deleteSwitch");var confirm_link=modal.find("a.btn-primary").first();confirm_link.off("click");confirm_link.click(function(){that.switches.get({url:url,success:function(data){showSuccess($("#switches"),data.status_msg);row.fadeOut("slow",function(){$(this).remove()})},always:function(){modal.modal("hide")},errorSibling:$("#switches")});return false});modal.modal({show:true});return false};SwitchView.prototype.invalidateCache=function(e){e.preventDefault();var modal=$("#modalSwitch");var modal_body=modal.find(".modal-body");var link=$(e.target);var url=link.attr("href");this.switches.get({url:url,success:function(data){showSuccess(modal_body.children().first(),data.status_msg)},errorSibling:modal_body.children().first()})};SwitchView.prototype.searchSwitch=function(query,process){this.switches.post({url:"/config/switch/search",data:{json:1,all_or_any:"any","searches.0.name":"id","searches.0.op":"like","searches.0.value":query},success:function(data){var results=$.map(data.items,function(i){return i.id});var input=$("#modalSwitch #newMember");var control=input.closest(".control-group");if(results.length===0)control.addClass("error");else control.removeClass("error");process(results)}})};$(function(){function showViolation(data){var modal=$("#modalViolation");modal.empty();modal.append(data);modal.find(".switch").bootstrapSwitch();modal.find(".chzn-select").chosen({inherit_select_classes:true,width:""});modal.find(".chzn-deselect").chosen({allow_single_deselect:true,width:""});modal.one("shown",function(){var data=modal.find(".event_triggers").first()[0];violationsView.event_triggers=JSON.parse(data.textContent||data.innerHTML);$("#actions").trigger("change")});$(".trigger option").each(function(elem){var jthis=$(this);var infos=jthis.val().split("::");if(infos[0].toLowerCase()=="accounting"){var new_value=violationsView.prettify_accounting(infos[0],infos[1]);jthis.html(new_value);jthis.closest("select").trigger("chosen:updated")}});modal.modal("show")}$("#section").on("click",'[href*="#modalViolation"]',function(event){var url=$(this).attr("href");var section=$("#section");var loader=section.prev(".loader");loader.show();section.fadeTo("fast",.5);$.ajax(url).always(function(){loader.hide();section.stop();section.fadeTo("fast",1)}).done(function(data){showViolation(data)}).fail(function(jqXHR){var status_msg=getStatusMsg(jqXHR);$("body,html").animate({scrollTop:0},"fast");showError($("#section h2"),status_msg)});return false});$("#section").on("click","#createViolation",function(event){var url=$(this).attr("href");var section=$("#section");var loader=section.prev(".loader");loader.show();section.fadeTo("fast",.5);$.ajax(url).always(function(){loader.hide();section.stop();section.fadeTo("fast",1)}).done(function(data){showViolation(data)}).fail(function(jqXHR){$("body,html").animate({scrollTop:0},"fast");var status_msg=getStatusMsg(jqXHR);showError($("#section h2"),status_msg)});return false});$("#section").on("change","#viewTriggers select",function(){violationsView.recompute_triggers()});$("#section").on("click",'[href*="/delete"]',function(e){e.preventDefault();if($(this).hasClass("disabled"))return false;var link=$(this);var url=link.attr("href");var row=link.closest("tr");var cells=row.find("td");var name=$(cells[1]).text();if(!name)name=$(cells[0]).text();var modal=$("#deleteViolation");var confirm_link=modal.find("a.btn-primary").first();modal.find("h3 span").html(name);modal.modal("show");confirm_link.off("click");confirm_link.click(function(e){e.preventDefault();confirm_link.button("loading");$.ajax(url).always(function(){modal.modal("hide");confirm_link.button("reset")}).done(function(data){row.remove();var table=$("#section table");if(table.find("tbody tr").length===0){table.remove();$("#noViolation").removeClass("hidden")}}).fail(function(jqXHR){var status_msg=getStatusMsg(jqXHR);showError($("#section h2"),status_msg);confirm_link.button("reset")})});return false});$("body").on("change","#actions",function(event){var actions=$(this).val();var vclose_group=$("#vclose").closest(".control-group");if($.inArray("close",actions)<0)vclose_group.fadeOut("fast");else vclose_group.fadeIn("fast");var role_group=$("#target_category").closest(".control-group");if($.inArray("role",actions)<0)role_group.fadeOut("fast");else role_group.fadeIn("fast");var command_group=$("#external_command").closest(".control-group");if($.inArray("external",actions)<0)command_group.fadeOut("fast");else command_group.fadeIn("fast");command_group=$("#user_mail_message").closest(".control-group");if($.inArray("email_user",actions)<0)command_group.fadeOut("fast");else command_group.fadeIn("fast");command_group=$("#access_duration").closest(".control-group");if($.inArray("autoreg",actions)<0)command_group.fadeOut("fast");else command_group.fadeIn("fast")});$("body").on("switch-change","#violations .switch",function(event,value){event.preventDefault();var t=$(event.target);if(t.attr("processing")){return}t.attr("processing","processing");var href=t.attr("data-href");var toggle=value.value?"yes":"no";href=href.replace(/enabled$/,toggle);$.ajax({type:"POST",url:href,data:""}).always(function(){t.attr("processing",null)}).done(function(data){showSuccess($("#section h2"),data.status_msg)}).fail(function(jqXHR){var status_msg=getStatusMsg(jqXHR);showError($("#section h2"),status_msg)})});$("body").on("submit",'form[name="violation"]',function(event){var form=$(this),btn=form.find(".btn-primary"),modal=$("#modalViolation"),modal_body=modal.find(".modal-body"),valid=isFormValid(form);if(valid){resetAlert(modal_body);btn.button("loading");$.ajax({type:"POST",url:form.attr("action"),data:form.serialize()}).always(function(){btn.button("reset")}).done(function(){modal.on("hidden",function(){$(window).hashchange()});modal.modal("hide")}).fail(function(jqXHR){var status_msg=getStatusMsg(jqXHR);resetAlert(modal_body);showPermanentError(modal_body.children().first(),status_msg)})}return false});$.fn.typeahead.Constructor.prototype.select=function(){var val=this.$menu.find(".active").data("item");this.$element.val(this.updater(val)).change();return this.hide()};$.fn.typeahead.Constructor.prototype.render=function(items){var that=this;items=$(items).map(function(i,item){i=$(that.options.item).data("item",item);i.find("a").html(that.highlighter(item));return i[0]});items.first().addClass("active");this.$menu.html(items);return this};$("body").on("click",'[href="#deleteTrigger"]',function(event){event.preventDefault();var jthis=$(event.target);jthis.closest(".control-group").remove();if(!$("#viewTriggers").find("select").length){$("#noTrigger").removeClass("hide")}violationsView.recompute_triggers();return false});$("body").on("click",'[href="#addTrigger"]',function(event){event.preventDefault();var jthis=$(event.target);$("#viewTriggers").slideUp(function(){$("#editedTrigger").html(ViolationsView.add_combined_trigger_form());violationsView.previous_trigger_options=$("#editedTrigger .triggerButtons").html();$("#editedTrigger .triggerButtons").html('<a href="#backEditTrigger" class="pull-left btn btn-default"><i class="icon  icon-chevron-left"></i></a>');$("#editedTrigger .chzn-select").chosen({inherit_select_classes:true,width:""});$("#editTrigger").slideDown()});return false});$("body").on("click",'[href="#editTrigger"]',function(event){event.preventDefault();var jthis=$(event.target);$("#viewTriggers").slideUp(function(){var triggers=jthis.closest(".control-group");triggers.appendTo("#editedTrigger");violationsView.previous_trigger_options=$("#editedTrigger .triggerButtons").html();$("#editedTrigger .triggerButtons").html('<a href="#backEditTrigger" class="pull-left btn btn-default"><i class="icon  icon-chevron-left"></i></a>');$("#editTrigger").slideDown()});return false});$("body").on("click",'[href="#backEditTrigger"]',function(event){event.preventDefault();var jthis=$(event.target);$("#editTrigger").slideUp(function(){var triggers=jthis.closest(".control-group");if(triggers.find("select option:selected").length){$("#noTrigger").addClass("hide");triggers.find(".triggerButtons").html(violationsView.previous_trigger_options);triggers.appendTo("#viewTriggers")}$("#editedTrigger").html("");$("#viewTriggers").slideDown()});violationsView.recompute_triggers();return false});$("body").on("click","#add_trigger_part",function(event){event.preventDefault();var tid=$("#tid");var id=tid.val();var type_select=$("#trigger_type").find(":selected");var type=type_select.val();if(type==="")return false;var type_name=type_select.text();var value=type+"::"+id;var value_pretty=type_name+" : "+id;violationsView.append_trigger(value,value_pretty)});$("body").on("click",".add_accounting_trigger",function(event){event.preventDefault();var trigger_direction=$("#accounting_widget_direction").find(":selected").val();var trigger_amount=$("#accounting_widget_amount").val();var trigger_unit=$("#accounting_widget_unit").find(":selected").val();var trigger_window=$("#accounting_widget_window").find(":selected").val();var tid=trigger_direction+trigger_amount+trigger_unit+trigger_window;var trigger="accounting::"+tid;violationsView.append_trigger(trigger,violationsView.prettify_accounting("accounting",tid))});$("body").on("click",".add_trigger_part",function(event){event.preventDefault();event.stopPropagation();var tid=$(this).closest(".controls").find("select").find(":selected");var id=tid.val();var type_select=$("#trigger_type").find(":selected");var type=type_select.val();var type_name=type_select.html();var value=type+"::"+id;var value_pretty=type_name+" : "+tid.html();violationsView.append_trigger(value,value_pretty)});$("body").on("click","#violationSubmit",function(event){event.preventDefault();$("#editTrigger .control-group select").not("#trigger_type").not(".trigger_widget_select").appendTo("#viewTriggers");violationsView.recompute_triggers();$('[name="violation"]').submit();return false});$("body").on("change","#trigger_type",function(){var type=$("#trigger_type option:selected").val();$(".trigger_widget").slideUp();$("."+type+"_triggers").slideDown()});$("body").on("click",".trigger_widget a",function(){var modal=$("#modalViolation");modal.modal("hide");window.location=$(this).attr("href")})});var ViolationsView=function(){};ViolationsView.prototype.recompute_triggers=function(){var grouped={};$("#viewTriggers select").find(":selected").each(function(){var option=$(this);var select=option.closest("select");select.uniqueId();if(!grouped[select.attr("id")]){grouped[select.attr("id")]=[]}grouped[select.attr("id")].push(option.val())});var triggers=[];for(var key in grouped){var trigger;if(grouped[key].length>1){trigger=grouped[key].join("&");trigger="("+trigger+")"}else{trigger=grouped[key][0]}triggers.push(trigger)}$("#trigger").val(triggers.join())};ViolationsView.add_combined_trigger_form=function(){var form=['<div class="control-group">','  <span class="triggerButtons">','    <a class="btn pull-left" href="#editTrigger">','      <i class="icon icon-pencil"></i>',"    </a>",'    <a class="btn btn-danger pull-left" href="#deleteTrigger">','      <i class="icon icon-remove"></i>',"    </a>","  </span>",'  <select multiple="multiple" class="chzn-select input-xxlarge">',"  </select>","</div>"];return form.join(" ")};ViolationsView.prototype.prettify_accounting=function(type,value){var lc_type=type.toLowerCase();var lc_value=value.toLowerCase();var lc_trigger=lc_type+"::"+lc_value;var pretty;if(lc_value=="bandwidthexpired")pretty="Bandwidth expired";else if(lc_value=="timeexpired")pretty="Time expired";else{var rx=/^(TOT|IN|OUT)([0-9]+)(B|KB|MB|GB|TB)([DWMY])$/;var results=rx.exec(value);var direction=results[1];var amount=results[2];var unit=results[3];var timeframe=results[4];pretty="";if(direction=="TOT")pretty+="Total traffic over "+amount+" "+unit+" ";else if(direction=="IN")pretty+="Inbound traffic over "+amount+" "+unit+" ";else if(direction=="OUT")pretty+="Outbound traffic over "+amount+" "+unit+" ";if(timeframe=="D")pretty+="per day";else if(timeframe=="W")pretty+="per week";else if(timeframe=="M")pretty+="per month";else if(timeframe=="Y")pretty+="per year"}return pretty};ViolationsView.prototype.append_trigger=function(value,value_pretty){var that=this;if(!value_pretty)value_pretty=value;var error=false;var select=$("#editedTrigger select").first();if(that.event_triggers.indexOf(value.split("::")[0].toLowerCase())>-1){select.find("option:selected").each(function(){var data=$(this).val().split("::");if(that.event_triggers.indexOf(data[0].toLowerCase())>-1){error=$(this).html()}})}if(error){showError($("#viewTriggers"),"There is already an evenemential trigger defined ("+error+"). Only one is allowed per combined trigger.");return}var last=true;select.find("option").each(function(){if($(this).val()>value){$('<option value="'+value+'" selected="selected">'+value_pretty+"</option>").insertBefore(this);last=false;return false}});if(last)select.append('<option value="'+value+'" selected="selected">'+value_pretty+"</option>");select.trigger("chosen:updated")};ViolationsView.prototype.add_fingerbank_trigger=function(search,id,display){var that=this;violationsView.append_trigger(search.model_stripped()+"::"+id,search.model_stripped()+" "+display)};var violationsView=new ViolationsView;
//# sourceMappingURL=configuration.js.map