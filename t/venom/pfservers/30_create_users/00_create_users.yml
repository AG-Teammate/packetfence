name: Create users
version: 2
testcases:
- name: create_users
  steps:
    - type: http
      method: POST
      url: '{{.pfserver_webadmin_url}}/api/v1/users'
      ignore_verify_ssl: true
      body: >-
        {
          "pid_overwrite": "0",
          "pid": "{{.create_user}}",
          "email": "test@inverse.ca",
          "sponsor": "admin",
          "password": "qwerty",
          "valid_from": "2020-04-13 00:00:00",
          "expiration": "2020-07-23 12:00:00",
          "actions": [ 
            {
              "type": "set_access_level",
              "value": "NONE"
            }   
          ]
        }
      headers:
        "Authorization": "{{.pfserver_token}}"
        "Content-Type": "application/json"
      assertions:
        - result.statuscode ShouldEqual 201
    
- name: create_password
  steps:
    - type: http
      method: POST
      url: '{{.pfserver_webadmin_url}}/api/v1/user/{{.create_user}}/password'
      ignore_verify_ssl: true
      body: >-
        {
          "quiet": "true",
          "pid_overwrite": "0",
          "pid": "{{.create_user}}",
          "email": "test@inverse.ca",
          "sponsor": "admin",
          "password": "qwerty",
          "valid_from": "2020-04-13 00:00:00",
          "expiration": "2020-07-23 12:00:00",
          "access_level": "NONE",
          "actions": [
            {
              "type": "set_access_level",
              "value": "NONE"
            }
          ]
        }
      headers:
        "Authorization": "{{.pfserver_token}}"
        "Content-Type": "application/json"
      assertions:
        - result.statuscode ShouldEqual 201

